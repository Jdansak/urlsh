<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>URLsh — URL Shortener</title>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: system-ui, -apple-system, sans-serif;
      background: #0f0f13;
      color: #e2e2e8;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 3rem 1rem;
    }

    h1 {
      font-size: 2.4rem;
      font-weight: 800;
      letter-spacing: -0.03em;
      margin-bottom: 0.25rem;
      background: linear-gradient(135deg, #7c6dfa 0%, #a78bfa 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .tagline {
      color: #6b6b80;
      margin-bottom: 2.5rem;
      font-size: 0.95rem;
    }

    .card {
      background: #18181f;
      border: 1px solid #2a2a35;
      border-radius: 14px;
      padding: 2rem;
      width: 100%;
      max-width: 560px;
    }

    .input-row {
      display: flex;
      gap: 0.5rem;
    }

    input[type="url"] {
      flex: 1;
      padding: 0.65rem 1rem;
      border-radius: 8px;
      border: 1px solid #2a2a35;
      background: #0f0f13;
      color: #e2e2e8;
      font-size: 0.95rem;
      outline: none;
      transition: border-color 0.15s;
    }

    input[type="url"]:focus { border-color: #7c6dfa; }

    button {
      padding: 0.65rem 1.2rem;
      border-radius: 8px;
      border: none;
      background: #7c6dfa;
      color: #fff;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.15s;
      white-space: nowrap;
    }

    button:hover { background: #6a5cf0; }
    button:disabled { background: #3d3a55; cursor: not-allowed; }

    .result {
      margin-top: 1.2rem;
      display: none;
    }

    .result.show { display: block; }

    .result-label {
      font-size: 0.78rem;
      color: #6b6b80;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      margin-bottom: 0.4rem;
    }

    .result-row {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      background: #0f0f13;
      border: 1px solid #2a2a35;
      border-radius: 8px;
      padding: 0.5rem 0.75rem;
    }

    .short-url {
      flex: 1;
      color: #a78bfa;
      font-size: 1rem;
      font-weight: 600;
      text-decoration: none;
      word-break: break-all;
    }

    .short-url:hover { text-decoration: underline; }

    .copy-btn {
      padding: 0.35rem 0.75rem;
      font-size: 0.8rem;
      background: #2a2a35;
    }

    .copy-btn:hover { background: #3a3a48; }

    .error {
      margin-top: 0.75rem;
      color: #f87171;
      font-size: 0.88rem;
      display: none;
    }

    .error.show { display: block; }

    /* Stats table */
    .stats-section {
      width: 100%;
      max-width: 560px;
      margin-top: 2.5rem;
    }

    .stats-section h2 {
      font-size: 1rem;
      font-weight: 600;
      color: #6b6b80;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      margin-bottom: 1rem;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.85rem;
    }

    thead th {
      text-align: left;
      color: #6b6b80;
      font-weight: 500;
      padding: 0 0.5rem 0.6rem;
      border-bottom: 1px solid #2a2a35;
    }

    tbody tr:hover td { background: #18181f; }

    td {
      padding: 0.55rem 0.5rem;
      border-bottom: 1px solid #1e1e28;
      vertical-align: middle;
    }

    td.code a {
      color: #a78bfa;
      text-decoration: none;
      font-weight: 600;
    }

    td.code a:hover { text-decoration: underline; }

    td.original {
      max-width: 260px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      color: #888;
    }

    td.hits { text-align: right; color: #6b6b80; }

    .empty { color: #6b6b80; font-size: 0.88rem; padding: 1rem 0; }
  </style>
</head>
<body>

  <h1>URLsh</h1>
  <p class="tagline">Paste a long URL. Get a short one.</p>

  <div class="card">
    <div class="input-row">
      <input id="urlInput" type="url" placeholder="https://example.com/very/long/url" />
      <button id="shortenBtn">Shorten</button>
    </div>
    <p id="errorMsg" class="error"></p>
    <div id="result" class="result">
      <p class="result-label">Your short link</p>
      <div class="result-row">
        <a id="shortLink" class="short-url" href="#" target="_blank" rel="noopener"></a>
        <button class="copy-btn" id="copyBtn">Copy</button>
      </div>
    </div>
  </div>

  <div class="stats-section">
    <h2>Recent links</h2>
    <table>
      <thead>
        <tr>
          <th>Code</th>
          <th>Original URL</th>
          <th style="text-align:right">Hits</th>
        </tr>
      </thead>
      <tbody id="statsBody">
        <tr><td colspan="3" class="empty">Loading…</td></tr>
      </tbody>
    </table>
  </div>

  <script>
    const urlInput   = document.getElementById('urlInput');
    const shortenBtn = document.getElementById('shortenBtn');
    const result     = document.getElementById('result');
    const shortLink  = document.getElementById('shortLink');
    const copyBtn    = document.getElementById('copyBtn');
    const errorMsg   = document.getElementById('errorMsg');
    const statsBody  = document.getElementById('statsBody');

    async function shorten() {
      const url = urlInput.value.trim();
      if (!url) return;

      errorMsg.classList.remove('show');
      result.classList.remove('show');
      shortenBtn.disabled = true;

      try {
        const res = await fetch('/api/shorten', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ url }),
        });

        const data = await res.json();

        if (!res.ok) {
          errorMsg.textContent = data.error ?? 'Something went wrong.';
          errorMsg.classList.add('show');
        } else {
          shortLink.href = data.shortUrl;
          shortLink.textContent = data.shortUrl;
          result.classList.add('show');
          loadStats();
        }
      } catch {
        errorMsg.textContent = 'Network error. Is the server running?';
        errorMsg.classList.add('show');
      } finally {
        shortenBtn.disabled = false;
      }
    }

    shortenBtn.addEventListener('click', shorten);
    urlInput.addEventListener('keydown', e => { if (e.key === 'Enter') shorten(); });

    copyBtn.addEventListener('click', async () => {
      try {
        await navigator.clipboard.writeText(shortLink.href);
        copyBtn.textContent = 'Copied!';
        setTimeout(() => { copyBtn.textContent = 'Copy'; }, 1500);
      } catch {
        copyBtn.textContent = 'Failed';
      }
    });

    async function loadStats() {
      try {
        const res  = await fetch('/api/stats');
        const rows = await res.json();

        if (!rows.length) {
          statsBody.innerHTML = '<tr><td colspan="3" class="empty">No links yet.</td></tr>';
          return;
        }

        statsBody.innerHTML = rows.map(r => `
          <tr>
            <td class="code"><a href="/${r.code}" target="_blank" rel="noopener">/${r.code}</a></td>
            <td class="original" title="${escHtml(r.original)}">${escHtml(r.original)}</td>
            <td class="hits">${r.hits}</td>
          </tr>
        `).join('');
      } catch {
        statsBody.innerHTML = '<tr><td colspan="3" class="empty">Could not load stats.</td></tr>';
      }
    }

    function escHtml(str) {
      return str.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
    }

    loadStats();
  </script>
</body>
</html>
